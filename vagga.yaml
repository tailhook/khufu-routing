containers:
  js:
    setup:
    - !Alpine v3.6
    - !Install [nodejs-npm]
    - &nodeenv !Env
      NODE_PATH: /usr/lib/node_modules
      PATH: /bin:/usr/bin:/usr/local/bin:/usr/lib/node_modules/.bin
      BABEL_DISABLE_CACHE: 1
    - !YarnDependencies
    environ: *nodeenv

  example-simple:
    setup:
    - !Alpine v3.6
    - !Install [nodejs-npm]
    - *nodeenv
    - !YarnDependencies
      dir: examples/simple
      # until bug #3792 in yarn fixed
    - !Sh |
        ln -sfn /usr/lib/node_modules/webpack/bin/webpack.js /usr/bin/webpack
        ln -sfn /usr/lib/node_modules/webpack-dev-server/bin/webpack-dev-server.js /usr/bin/webpack-dev-server
    environ: *nodeenv

commands:
  make: !Command
    container: js
    run: [npm, run, build]

  test: !Command
    container: js
    run: [npm, run, test]

  webpack: !Command
    description: Run webpack (useful for compiling examples)
    container: js
    run: [webpack]

  example-simple: !Command
    description: Run simple example with dev server
    container: example-simple
    work-dir: /work/examples/simple
    run: [webpack-dev-server, --hot, --history-api-fallback]
